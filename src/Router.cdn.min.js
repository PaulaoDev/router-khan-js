"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _toArray2=_interopRequireDefault(require("@babel/runtime/helpers/toArray")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_construct2=_interopRequireDefault(require("@babel/runtime/helpers/construct")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),RouterProvide=function(){function e(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,_classCallCheck2.default)(this,e),r&&(document.body.innerHTML+='<div id="view-router"></div>'),this.routes=new Map,this.params=[]}var r;return(0,_createClass2.default)(e,null,[{key:"create",value:function(){if(!e.instance){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];e.instance=(0,_construct2.default)(this,t)}return e.instance}}]),(0,_createClass2.default)(e,[{key:"escapeRegExp",value:function(e){return"^"+e.replace(/\//gim,"\\/")+"$"}},{key:"isRouteParam",value:function(e){var r=function(e){return e.match(/\{(.*?)\}/gim)}(e);if(r&&Array.isArray(r)){var t=r.map((function(e){return(r=e,r.replace(/(\{|\})/gim,"")).trim();var r})),n=function(e,r){return e.replace(new RegExp("(".concat(r.join("|"),")"),"gim"),"(.*?)")}(e,r);return{keys:t,newRoute:n}}return!1}},{key:"toRoute",value:function(e){return"/#"+e}},{key:"redirect",value:function(e){var r=this.toRoute(e);return window.location=r,r}},{key:"any",value:function(e){if(!1===this.routes.has(e)){for(var r=this.isRouteParam(e),t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];if(!1===r||null===r)this.routes.set(new RegExp(this.escapeRegExp(e)),n.reverse());else if(r.hasOwnProperty("newRoute")){var i=new RegExp(this.escapeRegExp(r.newRoute));this.params.push({route:i,keys:r.keys}),this.routes.set(i,n.reverse())}}}},{key:"runMiddleware",value:(r=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function e(r,t){var n,a,i;return _regenerator.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=document.getElementById("view-router"),a=null,i=0;i<r.length;i+=1)a=r[i].bind(null,t,n,a);a();case 4:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"trate",value:function(e){var r=Array.from(this.routes.keys()).find((function(r,t){return r.test(e)}));if(r){var t=this.routes.get(r),n=this.params.find((function(e){return e.route===r}));if(n&&t){var a=e.match(n.route),i=(0,_toArray2.default)(a).slice(1),u={};return n.keys.map((function(e,r){return u[e]=i[r]})),console.log(u),this.runMiddleware(t,u)}return this.runMiddleware(t,{})}}},{key:"push_event",value:function(e){window.history.pushState({url:e},e,e);this.trate(e)}},{key:"dispatch",value:function(){var e=this;window.onpopstate=function(r){var t=""!==window.location.hash?window.location.hash.split("#").pop():window.location.pathname;e.push_event(t)};var r=""!==window.location.hash?window.location.hash.split("#").pop():window.location.pathname;this.push_event(r)}}]),e}();exports.default=RouterProvide;
